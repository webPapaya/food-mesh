<%= @pie_chart.inspect %>

<svg width="<%= @pie_chart[:width_height]*2%>" height = "<%= @pie_chart[:width_height] %>" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1">
  <defs>
    <% @pie_chart[:values].length.times do |i| %>

          <mask id="mask<%= i %>" x="0" y="0" width="<%= @pie_chart[:width_height] %>" height="<%= @pie_chart[:width_height] %>">
            <g>
                <circle cx="<%= @pie_chart[:center]%>" cy="<%= @pie_chart[:center] %>" r="<%= @pie_chart[:values][i][:percent] %>" fill="white"> </circle>
                <animateTransform attributeType="xml" attributeName="transform" type="scale"
                              from="0"
                              to="1"
                              dur="1.5s" fill="freeze" />
            </g>
          </mask>

    <% end  %>
    <path id="pie" d="<%= "M #{ @pie_chart[:center] } #{ @pie_chart[:center] }  L #{ @pie_chart[:coords]['x1'] } #{@pie_chart[:coords]['y1']} L #{ @pie_chart[:coords]['x2'] } #{  @pie_chart[:coords]['y2'] } Z" %>"></path>
  </defs>

  <% @pie_chart[:line_coords].each do |coord| %>
      <text
          style="background: black;"
          width="100"
          height="20"
          x="<%= coord[:x] %>"
          y="<%= coord[:y] %>">
        hallo
      </text>
  <% end %>

  <g id="wrapper">
    <g id="daily-amount">
      <circle cx="<%= @pie_chart[:center] %>" cy="<%= @pie_chart[:center] %>" r="<%= @pie_chart[:center] - 5 %>" fill="none" style="stroke:rgb(227, 228, 229); stroke-width:10; stroke-location: inside;"> </circle>
      <circle cx="<%= @pie_chart[:center] %>" cy="<%= @pie_chart[:center]%>" r="<%= @pie_chart[:center] - 5 %>" fill="none" style="stroke:#66A4D1; stroke-width:10;" stroke-dasharray="<%= "#{@pie_chart[:daily_kcal]['line']} #{@pie_chart[:daily_kcal]['space']}" %>" transform="rotate(-90,  <%= @pie_chart[:center] %>, <%= @pie_chart[:center] %>)"></circle>
    </g>

      <% (0...@pie_chart[:values].length).each do |i| %>
          <g class="pie" mask="url(#mask)">

            <use mask="url(#mask<%=i%>)" transform="rotate(<%= @pie_chart[:inner_angle] * i %>, <%= @pie_chart[:center] %>, <%= @pie_chart[:center] %>)"  xlink:href="#pie" fill="<%= @pie_chart[:colors][Random.rand(8)] %>" style="stroke:#e6e6e6;stroke-width:7"></use>
            <desc>
              <title><%= @pie_chart[:values][i][:ingredient] %></title>
              <percent><%= @pie_chart[:values][i][:percent] %></percent>
              <value><%= @pie_chart[:values][i][:value] %></value>
            </desc>

            <line
                x1="<%= @pie_chart[:center] %>"
                y1="<%= @pie_chart[:center] %>"
                x2="<%= @pie_chart[:width_height] %>"
                y2="<%= @pie_chart[:center] %>"
                transform="rotate(<%= @pie_chart[:inner_angle] * i %>, <%= @pie_chart[:center] %>, <%= @pie_chart[:center] %>)"
                style="stroke:rgb(255,0,0);stroke-width:2">
            </line>
          </g>


      <% end %>

  </g>
  <mask id="mask" x="0" y="0" width="<%= @pie_chart[:center] * 2%>" height="<%= @pie_chart[:center] * 2%>">
    <circle cx="<%= @pie_chart[:center] %>" cy="<%= @pie_chart[:center] %>" r="<%= @pie_chart[:chart_mask]['outer'] %>" fill="white"></circle>
    <circle cx="<%= @pie_chart[:center] %>" cy="<%= @pie_chart[:center] %>" r="<%= @pie_chart[:chart_mask]['inner'] %>" fill="black"></circle>
  </mask>


  <text>lalalalal</text>
</svg>