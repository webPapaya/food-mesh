<%= @pie_chart.inspect %>

<svg id="pie-chart" width="<%= @pie_chart[:width_height]%>" height = "<%= @pie_chart[:width_height] %>" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1">
  <defs>
    <% @pie_chart[:values].length.times do |i| %>
          <mask id="mask<%= i %>" x="0" y="0" width="<%= @pie_chart[:chart_width] %>" height="<%= @pie_chart[:chart_width] %>">
            <g>
              <circle cx="<%= @pie_chart[:chart_center]%>" cy="<%= @pie_chart[:chart_center] %>" r="<%= @pie_chart[:values][i][:percent] %>" fill="white"> </circle>
            </g>
          </mask>

     <% end  %>
  </defs>


  <%# max amount day %>
  <circle id="max-daily-amount"
          cx="<%= @pie_chart[:chart_center]%>"
          cy="<%= @pie_chart[:chart_center] %>"
          r="<%= @pie_chart[:chart_width]/2 %>"
          fill="none"> </circle>

  <% @pie_chart[:values].length.times do |idx| %>
      <%
         #should be moved to controller
         next_idx = idx + 1
         next_idx = 0 if @pie_chart[:line_coords][next_idx].nil?
      %>



      <g id="<%="ingredient-#{@pie_chart[:values][idx][:ingredient]}" %>" class="pie-item">
              <clipPath id="<%="mask-#{@pie_chart[:values][idx][:ingredient]}" %>"
                    x="<%= @pie_chart[:chart_center] %>"
                    y="<%= @pie_chart[:chart_center] %>"
                    width="<%= @pie_chart[:chart_width] %>"
                    height="<%= @pie_chart[:chart_width] %>">

                        <circle cx="<%= @pie_chart[:chart_center]%>"
                                cy="<%= @pie_chart[:chart_center] %>"
                                r="<%= @pie_chart[:values][idx][:percent] %>"
                                fill="white"> </circle>
              </clipPath>



        <text
            x="<%= get_label_coords @pie_chart[:line_coords][idx][:x] %>"
            y="<%= calc_label_circle @pie_chart[:line_coords][idx][:y] %>">
              <%= @pie_chart[:values][idx][:ingredient] %>
            </text>



        <!--pie element-->
        <path id="pie"
              class="pie-path"
              clip-path="url(<%="#mask-#{@pie_chart[:values][idx][:ingredient]}" %>)"
              d="<%= "M #{ @pie_chart[:chart_center] } #{ @pie_chart[:chart_center] }
                    L #{ calc_label_circle @pie_chart[:line_coords][idx][:x], 100 }
                      #{ calc_label_circle @pie_chart[:line_coords][idx][:y], 100}
                    L #{ calc_label_circle @pie_chart[:line_coords][next_idx][:x], 100 }
                      #{ calc_label_circle @pie_chart[:line_coords][next_idx][:y], 100 }
                    Z" %>"></path>

        <!--pie element for hover effect-->
        <path id="pie"
              class="pie-path-back"
              d="<%= "M #{ @pie_chart[:chart_center] } #{ @pie_chart[:chart_center] }
                    L #{ @pie_chart[:line_coords][idx][:x] } #{@pie_chart[:line_coords][idx][:y]}
                    L #{ @pie_chart[:line_coords][next_idx][:x] } #{@pie_chart[:line_coords][next_idx][:y]}
                    Z" %>"></path>
      </g>
  <% end %>



  <%# because svg uses painters algorithm for painting we have to draw all lines in a seperate loop %>
  <g class="lines">
      <% @pie_chart[:values].length.times do |idx| %>
            <line class="pie-chart-lines"
                x1="<%= @pie_chart[:chart_center] %>"
                y1="<%= @pie_chart[:chart_center] %>"
                x2="<%= calc_label_circle @pie_chart[:line_coords][idx][:x] %>"
                y2="<%= calc_label_circle @pie_chart[:line_coords][idx][:y] %>"></line>
      <% end %>
  </g>





  <g id="wrapper">
    <g id="daily-amount">
      <!--dalyamount grey ring-->
      <circle
        cx="<%= @pie_chart[:chart_center] %>"
        cy="<%= @pie_chart[:chart_center] %>"
        r="<%= @pie_chart[:chart_width] %>"
        fill="none" style="stroke:rgb(227, 228, 229); stroke-width:10; stroke-location: inside;"></circle>
      <!--daily amount blue ring-->
      <circle
        cx="<%= @pie_chart[:chart_center] %>"
        cy="<%= @pie_chart[:chart_center]%>"
        r="<%= @pie_chart[:chart_width] %>"
        fill="none"
        style="stroke:#66A4D1; stroke-width:10;"
        stroke-dasharray="<%= "#{@pie_chart[:daily_kcal]['line']} #{@pie_chart[:daily_kcal]['space']}" %>"
        transform="rotate(-90,  <%= @pie_chart[:chart_center] %>, <%= @pie_chart[:chart_center] %>)"></circle>
    </g>
  </g>

</svg>