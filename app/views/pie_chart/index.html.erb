<%= @debug.inspect %>

<svg width="<%= @width_height %>" height = "<%= @width_height%>" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1">
  <defs>
    <mask id="mask" x="0" y="0" width="<%= @center * 2%>" height="<%= @center * 2%>">
      <circle cx="<%= @center %>" cy="<%= @center %>" r="<%= @chart_mask['outer'] %>" fill="white"/>
      <circle cx="<%= @center %>" cy="<%= @center %>" r="<%= @chart_mask['inner'] %>" fill="black"/>
    </mask>

    <% (0...@segments).each do |i| %>
        <mask id="mask<%=i%>" x="0" y="0" width="<%= @center * 2%>" height="<%= @center* 2 %>">
          <circle cx="<%= @center%>" cy="<%= @center%>" r="<%= Random.rand(@center)%>" fill="white"/>
        </mask>
    <% end  %>

    <path id="pie" d="M <%= @center%> <%= @center%> L<%= @coords['x1'] %> <%= @coords['y1'] %> L<%= @coords['x2'] %> <%= @coords['y2'] %> Z" />
  </defs>

  <g id="wrapper">
    <g mask="url(#mask)">
      <% (0...@segments).each do |i| %>
          <use mask="url(#mask<%=i%>)" transform="rotate(<%= @inner_angle * i %>, <%= @center %>, <%= @center %>)"  xlink:href="#pie" fill="<%= @colors[Random.rand(8)] %>" style="stroke:rgb(255,255,255);stroke-width:7"></use>
      <% end %>
    </g>

    <g id="daily-amount">
      <circle cx="<%= @center%>" cy="<%= @center%>" r="<%= @center - 5 %>" fill="none" style="stroke:rgb(227, 228, 229); stroke-width:10; stroke-location: inside;"/>
      <circle cx="<%= @center%>" cy="<%= @center%>" r="<%= @center - 5 %>" fill="none" style="stroke:#66A4D1; stroke-width:10;" stroke-dasharray="<%= "#{@circle['line']} #{@circle['space']}" %>" transform="rotate(-90,  <%= @center %>, <%= @center %>)"/>
    </g>
  </g>
</svg>